(()=>{"use strict";const e=document.querySelector("#typograf"),t=new class{#e="";#t=0;#i="«";#r="»";#a={literals:{"1/2":"½","1/3":"⅓","1/4":"¼","1/5":"⅕","1/6":"⅙","1/7":"⅐","1/8":"⅛","1/9":"⅑","1/10":"⅒","2/3":"⅔","2/5":"⅖","3/4":"¾","3/5":"⅗","3/8":"⅜","4/5":"⅘","5/6":"⅚","5/8":"⅝","7/8":"⅞"},values:function(){return Object.values(this.literals).join("")}};#n={literals:{0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","—":"⁻","+":"⁺","=":"⁼","(":"⁽",")":"⁾",o:"°",о:"°",'"':"″"},values:function(){return Object.values(this.literals).join("")}};#s=[{pattern:/\u00A0 | \u00A0/g,replace:"  "},{pattern:/\u202F | \u202F/g,replace:" "},{pattern:/[\u00A0\u202F]+/g,replace:" "},{pattern:/(?<![!-])--(?![->])/g,replace:()=>(this.#t--,"-")},{pattern:/([—–−])/g,replace:"-"}];#l=[{pattern:new RegExp(`(?<= |^|\\d|[${this.#a.values()}])-(?=\\d|[${this.#a.values()}])`,"g"),replace:"−"},{pattern:/\+\/-/g,replace:()=>(this.#t-=2,"±")},{pattern:/(?<=(?:\d|[a-z])\s*)-:-/gi,replace:()=>(this.#t-=2,"÷")},{pattern:/(?<= |^|>|[^-!а-яёa-z0-9])-(?= |$|[^-])/gi,replace:"—"},{pattern:/(?<!^|["»:;.!?…, ]) —(?!-)/gm,replace:" —"},{pattern:/([ ]+)—([ ]*?)(["«a-zа-яё0-9])/gim,replace:(e,t,i,r)=>(this.#t-=(t.length?t.length-1:0)+(i.length?i.length-1:0),` — ${r}`)},{pattern:/—(?=\d)/g,replace:"−"},{pattern:/\([cс]\)/gi,replace:()=>(this.#t-=2,"©")},{pattern:/\(r\)/gi,replace:()=>(this.#t-=2,"®")},{pattern:/\(tm\)/gi,replace:()=>(this.#t-=3,"™")},{pattern:/\(р\)/gi,replace:()=>(this.#t-=2,"₽")},{pattern:/(?<![.…])\.{3}(?!\.)/g,replace:()=>(this.#t-=2,"…")},{pattern:/…(\.+)/g,replace:(e,t)=>(this.#t+=2,`...${t}`)},{pattern:/(\d)[xх](\d)/gi,replace:"$1×$2"},{pattern:/\b([123457]\/(?:[2-9]|10))\b/g,replace:(e,t)=>(this.#a.literals[t]&&(this.#t-=2),this.#a.literals[t]?this.#a.literals[t]:t)},{pattern:new RegExp(`([${this.#a.values()}])(\\d)`,"g"),replace:(e,t,i)=>(this.#t+=2,`${Object.entries(this.#a.literals).find((e=>e[1]===t))[0]}${i}`)},{pattern:/(\S)\^([0-9—+-=()]|[oо"])/gi,replace:(e,t,i)=>(this.#t--,`${t}${this.#n.literals[i]?this.#n.literals[i]:i}`)},{pattern:new RegExp(`([${this.#n.values()}])(?![ .])([0-9+-=()])`,"g"),replace:(e,t,i)=>`${t}${this.#n.literals[i]}`},{pattern:new RegExp(` ([${this.#n.values()}])`,"g"),replace:(e,t)=>{for(let e in this.#n.literals)if(this.#n.literals[e]===t)return` ${e}`}},{pattern:/["»](?=\S)/g,replace:this.#i},{pattern:/(?<=\S)["«]/g,replace:this.#r},{pattern:new RegExp(`"(${this.#i}[a-zа-яё0-9…])`,"ig"),replace:`${this.#i}$1`},{pattern:new RegExp(`([a-zа-яё0-9…?!]${this.#r})"`,"ig"),replace:`$1${this.#r}`},{pattern:new RegExp(`([-a-z0-9]+=)[${this.#i}${this.#r}]([^${this.#i}${this.#r}]*?)`,"ig"),replace:'$1"$2'},{pattern:new RegExp(`([-a-z0-9]+=)["]([^>${this.#i}${this.#r}]*?)[${this.#i}${this.#r}]`,"ig"),replace:'$1"$2"'},{pattern:/\b'([std]|ve|ll|clock)\b/gi,replace:"’$1"},{pattern:new RegExp(`([0-6]?[0-9])['′]([0-6]?[0-9])?(\\d+)[${this.#r}"]`,"g"),replace:"$1′$2$3″"},{pattern:/((?:[ \u00A0]|>|^|\t)[a-zа-яё]{1,2}) /gim,replace:"$1 "},{pattern:/-(то|ка)\u00A0/gi,replace:"-$1 "},{pattern:/(?:\s|\t|[\u00A0 ])(же?|л[иь]|бы?|ка)([.,!?:;])?\u00A0/gi,replace:" $1$2 "}];constructor(e,t){this._element=e,this._isContentEditable=!0===this._element.contentEditable,t&&(this.#i=t.leftOutQuote||"«",this.#r=t.rightOutQuote||"»")}get result(){return this.#e}process(){this.#e=this._element.value,this.#p(this.#s),this.#p(this.#l)}#p(e){this.#t=this.#c(),e.forEach((e=>{this.#e=this.#e.replace(e.pattern,e.replace)})),this._element.value=this.#e,this.#u(this.#t)}#c(){if(this._isContentEditable){this._element.focus();let e=document.getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(this._element),t.setEnd(e.endContainer,e.endOffset),t.toString().length}return this._element.selectionStart}#u(e){if(this._isContentEditable)return this._element.focus(),void document.getSelection().collapse(this._element,e);this._element.setSelectionRange(e,e)}}(e);e.addEventListener("input",(()=>{t.process()}));const i=document.querySelector("#highLight"),r=()=>{const t=[];i.innerHTML=`\n\t\t<p>\n\t\t\t${e.value.replace(/\bon[a-z]+="?[^">]+"?/gi,"").replace(/="?(?:javascript|void):/gi,'="#').replace(/(<\/?[a-z]+[^>]*?>)/gi,((e,i)=>(t.push(i),"<*>"))).replace(/\n{2,}/g,"</p><p>").replace(/\n/g,"<br />").replace(/\u00a0/g,'<span class="hlg">&nbsp;</span>').replace(/([…©®™₽×—–−„“«»″′’½⅓¼⅕⅙⅛⅔⅖¾⅗⅜⅘⅚⅝⅞±÷⁰¹²³⁴⁵⁶⁷⁸⁹⁻⁺⁼⁽⁾°]+)/gi,'<span class="hlb">$1</span>').replaceAll("<*>",(()=>{const e=t[0];return t.splice(0,1),e}))}\n\t\t</p>\n\t`};e.addEventListener("keyup",r);const a="напечатать",n="остановить",s=document.querySelector("#example").innerText,l=document.querySelector("#type");let p=null;const c=()=>{clearInterval(p),l.textContent=a,p=null};l.addEventListener("click",(()=>{if(p)return void c();e.value="",l.textContent=n;let i=0;p=setInterval((()=>{const a=s.substring(0,i+1);e.value=a,i=e.value.length,t.process(),i<e.value.length&&(i=e.value.length),r(),a.length>=s.length&&c()}),100)}))})();